# ВАЖНЫЕ ЗАМЕТКИ

## КРИТИЧЕСКИ ВАЖНО: ЛОГИРОВАНИЕ И ОШИБКИ

### НЕ СОЗДАВАТЬ ЛОГИ В ФАЙЛЫ
- У пользователя НЕТ доступа к логам сервера
- НИКОГДА не создавать файлы логов (fs.writeFileSync, fs.appendFile для логов)
- НИКОГДА не предлагать проверить логи
- Все ошибки и информация должны возвращаться в JSON ответе API

### ВСЕ ОШИБКИ В JSON
- Все ошибки должны возвращаться в ответе API с детальной информацией:
  - message (текст ошибки)
  - error (сообщение об ошибке)
  - errorName (тип ошибки)
  - errorCode (код ошибки, если есть)
  - sqlMessage (если SQL ошибка)
  - sql (SQL запрос, если SQL ошибка)
  - stack (в development режиме)
  - errorDetails (все детали ошибки)
- Не использовать console.log для критических ошибок - только возвращать в JSON ответе
- console.log можно использовать только для отладочной информации (не критично)

### ПРИНЦИПЫ РАБОТЫ
- Все ошибки должны быть видны в ответе API
- Не требовать доступа к логам для диагностики
- Все проблемы должны решаться через API ответы
- Socket.io ошибки также возвращаются через события в JSON формате

## ИНФОРМАЦИЯ О СЕРВЕРЕ BEGET

### Основные данные:
- **Пользователь:** `autogie1`
- **Сервер:** `ocelot` (beget)
- **Путь к проекту:** `~/autogie1.bget.ru/public_html`
- **Домен:** `atogie1.bget.ru`

### Node.js и npm:
- **Версия Node.js:** v18.19.0
- **Путь к Node.js:** `~/node-v18.19.0-linux-x64/bin/node`
- **Путь к npm:** `~/node-v18.19.0-linux-x64/bin/npm`

### Команды для работы:
- **Установка пакетов:**
  ```bash
  ~/node-v18.19.0-linux-x64/bin/npm install <package>
  ```
- **Запуск скриптов:**
  ```bash
  ~/node-v18.19.0-linux-x64/bin/node scripts/cronTasks.js
  ```
- **Перезапуск сервера (Passenger):**
  ```bash
  touch tmp/restart.txt
  ```

### Важно:
- На beget НЕТ системного cron (команда `crontab` недоступна)
- Используется `node-cron` внутри приложения для автоматических задач
- Cron задачи запускаются автоматически при старте сервера
- Расписание настраивается через переменную окружения `CRON_SCHEDULE` в `.env`

### Passenger и app.listen:
- **КРИТИЧЕСКИ ВАЖНО:** Для Passenger на Beget НЕ вызываем `app.listen()` или `server.listen()`
- Passenger сам управляет портом и сервером
- Вызываем `server.listen()` только для локальной разработки (`require.main === module && NODE_ENV !== 'production'`)
- Socket.io работает через HTTP сервер, который создается из Express app

