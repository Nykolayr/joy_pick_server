-- Миграция: Добавление полей read_by и unread_by в таблицу messages
-- Удаление таблицы message_reads

-- 1. Добавляем JSON поля в таблицу messages
ALTER TABLE messages 
ADD COLUMN read_by JSON NULL COMMENT 'Массив ID пользователей, которые прочитали сообщение',
ADD COLUMN unread_by JSON NULL COMMENT 'Массив ID пользователей, которые не прочитали сообщение';

-- 2. Удаляем таблицу message_reads (все данные будут потеряны)
DROP TABLE IF EXISTS message_reads;

-- 3. Создаем индексы для быстрого поиска (JSON_EXTRACT для MySQL 5.7+)
-- Для MySQL 8.0+ можно использовать виртуальные колонки, но для совместимости используем функциональные индексы
-- Примечание: В MySQL 5.7+ JSON_EXTRACT работает, но индексы на JSON поля создаются через виртуальные колонки

-- Для оптимизации запросов можно создать виртуальные колонки (MySQL 5.7+)
-- Но для простоты оставим как есть, так как JSON_EXTRACT достаточно быстр для небольших массивов

