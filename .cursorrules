# КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА ДЛЯ СЕРВЕРНОЙ ЧАСТИ

## ПЕРЕД НАЧАЛОМ РАБОТЫ - ОБЯЗАТЕЛЬНО ПРОЧИТАТЬ
1. **CURRENT_STAGE.md** - текущее состояние проекта, последние изменения, текущие задачи
2. **PHILOSOPHY.md** - философия работы над проектом, процесс работы, принципы
3. **IMPORTANT_NOTES.md** - критически важные правила работы с сервером

## НЕ ПРЕДЛАГАТЬ ПРОВЕРКУ ЛОГОВ
- У пользователя НЕТ доступа к логам сервера
- НИКОГДА не предлагать проверить логи
- Все ошибки должны возвращаться в ответе API
- Не использовать console.log для критических ошибок - только возвращать в JSON ответе

## ПРИНЦИПЫ РАБОТЫ
- Все ошибки должны быть видны в ответе API
- Не требовать доступа к логам для диагностики
- Все проблемы должны решаться через API ответы
- Всегда читать CURRENT_STAGE.md, PHILOSOPHY.md и IMPORTANT_NOTES.md перед началом работы

## ИНФОРМАЦИЯ О СЕРВЕРЕ BEGET
- На beget НЕТ системного cron (команда `crontab` недоступна)
- Используется `node-cron` внутри приложения для автоматических задач
- Cron задачи запускаются автоматически при старте сервера
- Расписание настраивается через переменную окружения `CRON_SCHEDULE` в `.env`

## ОБРАБОТКА ОШИБОК - КРИТИЧЕСКИ ВАЖНО!
- ВСЕГДА передавать объект ошибки в функцию `error()` - третий параметр должен быть `err` или `error`
- НИКОГДА не возвращать просто "500 ошибка" без деталей
- Все ошибки должны возвращаться в JSON ответе API с детальной информацией:
  - message (текст ошибки)
  - error (сообщение об ошибке)
  - errorName (тип ошибки)
  - errorCode (код ошибки, если есть)
  - sqlMessage (если SQL ошибка)
  - sql (SQL запрос, если SQL ошибка)
  - stack (в development режиме)
  - errorDetails (все детали ошибки)
- Использовать функцию `error(res, message, statusCode, err)` - ВСЕГДА передавать `err` как 4-й параметр
- В development режиме возвращать stack trace в ответе
- НИКОГДА не предлагать проверить логи сервера
- Пример: `error(res, 'Ошибка при запуске cron задач', 500, err)` - ВСЕГДА с `err`!

